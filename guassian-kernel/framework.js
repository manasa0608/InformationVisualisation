'use strict'

let metaInfo

function initPage() {
  //populate page with required elements, e.g., header for title and drawing area

  const main = document.getElementById('main')

  metaInfo = getTutorialInfo() //should be provided in app.js
  if (!metaInfo) metaInfo = { groupNames: 'ERROR', exerciseNum: 'ERROR' }

  const mainTitle = document.createElement('h1')
  mainTitle.style.fontFamily = 'sans-serif'
  mainTitle.style.margin = '1rem auto'
  mainTitle.style.textAlign = 'center'
  mainTitle.textContent = 'InfoVIS Exercise ' + metaInfo.exerciseNum
  main.appendChild(mainTitle)

  document.title = 'InfoVIS Exercise ' + metaInfo.exerciseNum

  const groupBlock = document.createElement('h2')
  groupBlock.style.fontFamily = 'sans-serif'
  groupBlock.style.margin = '1rem auto'
  groupBlock.style.textAlign = 'center'
  groupBlock.style.color = 'gray'
  groupBlock.textContent = metaInfo.groupNames
  main.appendChild(groupBlock)

  const drawingArea = document.createElement('div')
  drawingArea.id = 'mainCanvas'
  drawingArea.style.width = '900px'
  drawingArea.style.height = '600px'
  drawingArea.style.margin = '4rem auto'
  main.appendChild(drawingArea)

  return drawingArea
}

function start() {
  if (document.getElementById('mainCanvas')) return //already initialized

  const drawingArea = initPage()

  const params = {
    width: 900,
    height: 600,
  }

  const two = new Two(params)
  two.appendTo(drawingArea)

  //perform drawing instructions, this is defined in app.js
  draw(two)

  // render content, either once or 60 times per second for animated/changeable shapes
  if (metaInfo.isAnimated) two.play()
  else two.update()
}

function getData() {
  const res = {}
  res.dataTask3 = [
    37.21430143475807,
    62.233323102630955,
    28.668206927065476,
    34.209128929399554,
    22.982641709962287,
    25.19472649566502,
    34.56830590056362,
    27.64501257810832,
    59.294430533807024,
    64.33813497325472,
    15.039249823847015,
    23.46072562750231,
    29.82139031898606,
    13.730349009174791,
    58.567658785950044,
    61.377768049175174,
    61.980581942591606,
    65.66713614789734,
    63.19510501038992,
    11.653398604591441,
    17.503598089604033,
    33.36772009387804,
    26.7252763359257,
    27.788752537697317,
    26.919410690342808,
    67.9665746069016,
    57.85386299671469,
    63.07863474350533,
    34.4491872387295,
    28.771671507983875,
    62.19858451639545,
    56.66786665086601,
    23.121120958995146,
    66.93012181112135,
    84.99744952481859,
    33.21043355239498,
    67.65802124165484,
    73.85045870056392,
    26.312707248880297,
    18.505417732724684,
    33.993955074234435,
    24.303795536039488,
    23.833606615488033,
    14.432811940267262,
    58.5388736449153,
    58.346459117925065,
    70.32462653177193,
    26.189675187003008,
    71.82259588562314,
    21.56100111574488,
    32.424632573130054,
    20.420347877872686,
    73.64787273919744,
    29.93299295597167,
    13.8336566670584,
    76.52835872995317,
    25.859124881091944,
    73.62979614697082,
    22.685019980265274,
    22.891938720238123,
    61.67777945040472,
    20.85873516139987,
    64.34697194898264,
    76.80490205706062,
    71.06111521121295,
    19.36077328229625,
    69.0917359507459,
    71.58946698015565,
    66.2450860500194,
    58.455449695330984,
    16.858594026936796,
    35.072385288344165,
    61.25765616010938,
    63.74539080913771,
    24.172405850075954,
    28.20089708343642,
    27.81863067964751,
    71.12741873054654,
    16.202446068568754,
    66.3377830366186,
    18.8562923329967,
    65.71556133998719,
    28.08372942863721,
    33.60091942782479,
    65.82637879255809,
    63.227052555042945,
    24.6026400003894,
    74.80791772361893,
    62.92713147491265,
    61.605330515097144,
    32.13510670990663,
    20.67827278771878,
    62.953858022080695,
    16.622475394694202,
    19.75384104477498,
    27.49846793114809,
    72.39362262657565,
    73.42431309879804,
    72.60231350571583,
    15.349962858504643,
    20.600979520244202,
    31.022156087427,
    19.179450388687396,
    63.25078966318435,
    19.627855563765454,
    69.79149148384836,
    74.05829193657124,
    14.802128047937668,
    64.51530223045073,
    24.59054038940043,
    27.05319928593646,
    25.64998898589086,
    32.648842146867345,
    65.6715818014715,
    19.993626084076443,
    7.802620797189961,
    19.629298222961417,
    22.013870827146608,
    31.745173576453666,
    17.710174222033455,
    59.93037999372636,
    16.209032786873337,
    33.631843815875925,
    64.5995131831184,
    13.855648244368298,
    23.64494899776225,
    66.99757809286817,
    66.40214470494317,
    11.821630630484629,
    63.768439149347806,
    23.206574109079284,
    16.905108451380947,
    22.08640788686008,
    76.3307085751784,
    63.98798068003076,
    25.879405045196194,
    21.38370673499248,
    67.03075503506832,
    34.44958685898965,
    27.82338947531386,
    59.5084490759732,
    31.545537857295635,
    65.59989737290047,
    71.22204634714845,
    12.8490191839568,
    25.627572738216806,
    70.78596340525324,
    18.51032970936263,
    73.07116657078446,
    33.1347043156084,
    66.29826283789149,
    65.10700492074024,
    76.39984979040355,
    22.505167927483363,
    25.63194206266558,
    70.58995839133524,
    14.53757814053996,
    24.705424039302393,
    77.70532616648119,
    27.303227232394455,
    19.167129740463338,
    22.511830576741264,
    66.92661714435067,
    69.97182924983468,
    42.464970025590105,
    30.828745396143688,
    18.086519818264314,
    20.039897238667486,
    67.30837070610716,
    22.828581614537992,
    20.878294889119548,
    70.33046831612059,
    66.11748055329572,
    25.400315769778565,
    60.89926789219817,
    65.17615499617389,
    63.93239012220511,
    70.1610094453536,
    62.09723754152883,
    78.31407610186498,
    63.56740160204816,
    25.987571420218778,
    34.0395987119314,
    71.69968534409557,
    35.23573516926301,
    25.13163628360819,
    21.85277617225836,
    25.67970333945123,
    66.34194275993092,
    21.268652738710603,
    30.310176981524855,
    28.103688322967972,
    22.794391833014245,
    34.4041448781083,
    20.82847901073901,
    20.244120488297074,
    69.42391772145241,
    32.971078677139204,
    24.476045841175775,
    33.26743318537904,
    59.76564514322669,
    22.832758906132334,
    69.81819487838075,
    23.498992630251585,
    54.87110797195006,
    75.40248914655936,
    76.90517914336922,
    22.937208235685077,
    66.40508929738121,
    34.16981955871845,
    27.73950732188777,
    20.217176084952783,
    63.82280979779486,
    65.68146784768372,
    22.69238373263495,
    15.40621810179073,
    18.93168579154988,
    65.19564588685671,
    25.161168077525033,
    17.896238940390422,
    20.93781006343656,
    21.70691129177589,
    32.93088188068396,
    70.50132264863828,
    33.33873675678169,
    70.95720948884474,
    21.845159967225257,
    23.319614684349165,
    34.1315024324439,
    67.80330066935254,
    61.15309735414908,
    19.22943269420421,
    14.60387304522917,
    61.94655916944301,
    23.916219641317152,
    24.94872481789312,
    26.448786952615805,
    69.82954994346957,
    9.296756696084095,
    21.44245366092988,
    60.37443149068077,
    65.5030689332527,
    17.264063751441444,
    17.28342185813964,
    30.989031944493274,
    32.64479672184187,
    20.41537877676717,
    59.61875800073274,
    31.135878906637632,
    26.74899187362579,
    24.872222861299,
    21.725880165860406,
    69.99459515055854,
    60.47745165532458,
    25.58229098154859,
    25.69389120418131,
    73.0145055338876,
    33.83551917596283,
    21.89652457390556,
    71.96159628750783,
    62.18534035575594,
    35.766096616827035,
    14.832387597910385,
    22.309254341764735,
    11.416566010951264,
    21.479231418081817,
    25.680061334784043,
    59.3250223345112,
    22.669565770469777,
    33.903091620231415,
    26.09453812619861,
    72.20998187081562,
    69.82412029828926,
    24.681993607275885,
    19.69438771031639,
    22.851223350104828,
    73.86514340419114,
    27.23302883995711,
    34.13710207231507,
    57.17541091866198,
    73.62803170298145,
    58.4169574289796,
    22.752671353498474,
    23.20724436572447,
    26.227701933358432,
    70.16311127111959,
    67.24687987579087,
    65.87441140012473,
    8.093387738888403,
    26.343010803395515,
    65.39334712005382,
    22.44446872055397,
    21.753385197054204,
    70.42214126230066,
    15.027877990488367,
    26.250537176968912,
    19.88011785979881,
    39.47229228103866,
    31.459472375466156,
    16.221343430788874,
    74.87384843180361,
    34.80317144262204,
    12.872799752764854,
    35.49930935079596,
    19.4768701969942,
    63.76469286128907,
    16.21551469519577,
    68.00870053491727,
    21.15142310788755,
    34.01060776909249,
    12.976834727643663,
    25.396753232648965,
    19.286463645161714,
    72.8362667254759,
    23.50975565619529,
    58.12059708784517,
    60.905087075065865,
    66.33809307296387,
    22.705274523822688,
    71.90354321307585,
    9.857268572733464,
    24.64913608089667,
    25.057709873603798,
    32.29120896674832,
    23.00339161673746,
    58.96660450453696,
    25.848112389777082,
    70.97272468167819,
    62.640377998809264,
    70.27354054071753,
    24.211755924794407,
    23.706343934981888,
    59.22208584557607,
    59.82147815971135,
    34.23868536251315,
    27.816088683617178,
    27.730601598194575,
    32.42817490572038,
    34.56076887163092,
    18.312125807709403,
    34.19557120260866,
    69.16469446697701,
    21.69684366636738,
    26.091783395674522,
    62.10811115790709,
    23.929105896454697,
    31.24661034776607,
    22.94189463482166,
    63.1183304743893,
    66.61125380820562,
    33.64614921168743,
    25.763235260525626,
    32.66681046597928,
    61.865418324118316,
    72.3113960462291,
    61.23370463360978,
    28.695174438607214,
    75.83277238627221,
    62.27688230126723,
    20.268562537349293,
    56.71788632995667,
    61.467198381819095,
    19.57434583455812,
    75.86119694114763,
    22.614823054894824,
    69.1262810749363,
    15.009889853563719,
    34.39899158396357,
    59.55384558252363,
    22.389162487324207,
    66.30151883314717,
    66.27408949395438,
    27.838381861456423,
    63.60384746063722,
    60.73773299968454,
    72.5242970256822,
    19.1320788367429,
    59.812639815394874,
    21.863486322651674,
    16.25548741930685,
    22.35077577110076,
    24.383711007630296,
    65.30645597940402,
    61.4968326276011,
    31.37619228710025,
    19.22214440487797,
    76.59722729405973,
    14.3789163721682,
    21.38246401341766,
    70.13372002386687,
    11.855810938021751,
    13.237473243162627,
    68.10942287974513,
    63.78610345797263,
    23.654485071502148,
    69.14205081005467,
    70.15973900122438,
    64.6129399659502,
    33.918976523721945,
    30.80164430045262,
    26.38345130402115,
    32.52169750553003,
    60.39749525311477,
    61.90818218614319,
    26.770522524249753,
    66.96558173495485,
    68.68146262297486,
    62.899545607258915,
    22.661984999613978,
    28.53514775370753,
    19.7706339026141,
    62.27169917790094,
    19.78159882903186,
    22.885648610306802,
    34.209464603360715,
    24.31904096367751,
    58.97735044584557,
    33.72827093089787,
    17.841991271138188,
    27.345839315254405,
    63.56702272145098,
    33.497455543211785,
    23.24563268599325,
    21.151376209523708,
    34.498037932565154,
    67.39892135660003,
    24.752838483444734,
    27.936138500510424,
    25.334023714963994,
    62.148421137589374,
    27.5692941435149,
    64.2647018068819,
    24.624082111614428,
    18.031025351501984,
    24.034017093827554,
    74.00390627510626,
    29.803889080561003,
    21.26765893319143,
    61.9933793125907,
    33.47554337732023,
    19.340641292396874,
    34.16738745710259,
    21.37802591440044,
    24.32448642299835,
    29.876031273646273,
    34.097394000249466,
    22.41385180636172,
    31.106795462617967,
    63.25564863660296,
    77.56304435142606,
    25.018868304249995,
    56.927398640536396,
    62.396825783653824,
    22.371864651711945,
    28.3043518396145,
    75.63989538170146,
    24.208034257887658,
    26.709365664409543,
    33.10452822023682,
    33.843032440683956,
    28.858800793294762,
    25.94338161943,
    28.76289290096954,
    29.307830831120114,
    23.78901975982738,
    64.18098755356796,
    21.22920242547085,
    71.32863511023098,
    17.375410632974187,
    65.04804423089827,
    68.93965793678998,
    21.478331915739002,
    69.08874123425895,
    24.783372680465554,
    20.56219119697934,
    61.02887975024374,
    67.93885486915146,
  ]

  return res
}

// functions for task 3 (KDE)
function _x_scale_for_task3(num) {
  return 50 + (num / 100) * 800
}

function _y_scale_for_task3(num) {
  return 600 - 50 - (num / 0.05) * 500
}

function drawAxesForTask3(two) {
  // x
  two.makeLine(
    _x_scale_for_task3(0),
    _y_scale_for_task3(-0.001),
    _x_scale_for_task3(100),
    _y_scale_for_task3(-0.001),
  )
  two.makeLine(
    _x_scale_for_task3(0),
    _y_scale_for_task3(-0.001),
    _x_scale_for_task3(0),
    _y_scale_for_task3(-0.002),
  )
  two.makeLine(
    _x_scale_for_task3(100),
    _y_scale_for_task3(-0.001),
    _x_scale_for_task3(100),
    _y_scale_for_task3(-0.002),
  )
  two.makeText('0', _x_scale_for_task3(0), _y_scale_for_task3(-0.004))
  two.makeText('100', _x_scale_for_task3(100), _y_scale_for_task3(-0.004))

  // y
  two.makeLine(
    _x_scale_for_task3(0) - 3,
    _y_scale_for_task3(0),
    _x_scale_for_task3(0) - 3,
    _y_scale_for_task3(0.05),
  )
  two.makeLine(
    _x_scale_for_task3(0) - 3,
    _y_scale_for_task3(0),
    _x_scale_for_task3(0) - 6,
    _y_scale_for_task3(0),
  )
  two.makeLine(
    _x_scale_for_task3(0) - 3,
    _y_scale_for_task3(0.05),
    _x_scale_for_task3(0) - 6,
    _y_scale_for_task3(0.05),
  )
  two.makeText('0', _x_scale_for_task3(0) - 15, _y_scale_for_task3(0))
  const t = two.makeText(
    '0.05',
    _x_scale_for_task3(0) - 25,
    _y_scale_for_task3(0.05),
  )
}

function createPathFromXY(X, Y) {
  const anchors = []
  X.forEach((x_, i) => {
    anchors.push(
      new Two.Anchor(_x_scale_for_task3(x_), _y_scale_for_task3(Y[i])),
    )
  })

  const path = new Two.Path(anchors, false, false)
  path.stroke = 'blue'
  path.linewidth = 1
  path.closed = false

  return path
}

//make sure that everything is loaded and all functions are ready to call before running framework
window.onload = start
